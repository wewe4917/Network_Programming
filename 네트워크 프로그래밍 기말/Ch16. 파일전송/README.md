# 네트워크프로그래밍 기말정리
## FTP 응용 프로그램
### > FTP 로그인
- FTP는 1970년대 초 인터넷이 보급되던 시기에 개발된 프로그램으로 네트워크 환경에서 가장 많이 이용되던 서비스 중 하나였으며, **원격 시스템과의 파일 송수신 기능을 지원**
- FTP 클라이언트를 이용해 FTP 서버에 접속하려면 FTP 서버의 호스트 주소와 포트 번호를 알아야 함
- **FTP 포트 번호는 전 세계적으로 공통인 Well-known포트**를 사용하므로 사용자가 따로 기억할 필요 없이 프로그램에서 자동으로 처리
### > 익명 FTP 로그인
- FTP 클라이언트로 파일을 송수신하려면 반드시 FTP 서버에 등록된 계정이 있어야 함
- 일반적으로 다중 사용자에게 파일 서비스를 제공하려고 불특정 다수에게 로그인 계정을 일일이 부여하는것은 현실적으로 불가능
- 이러한 형식으로 FTP 서비스를 제공해야 할 필요가 있는데, 이를 위한 방편으로 익명FTP 서비스를 이용
- **익명 FTP를 사용하려면 로그인 이름을 anonymous로 입력하고, 로그인 암호는 관례상 전자 메일 주소를 입력**\
 ![image](https://user-images.githubusercontent.com/120394200/207095309-4cf7d64e-4b94-408e-8eee-d3d2c48fcb40.png)

### > FTP 로그인
- 유닉스, 리눅스 시스템에서 FTP 서비스를 이용하는 방법
  - 사용자가 information.korea.co.kr의 FTP 서버와 연결을 시도하면 서버는 관련 메시지를 출력
  - 로그인 이름과 암호 입력을 요구
  - 서버에 등록된 로그인 이름인 hong과 암호를 FTP 서버에서 인증하면 FTP 로그인 절차가 완료\
![image](https://user-images.githubusercontent.com/120394200/207096199-3751c874-2adb-4b0f-919f-9abddbce3e61.png)
- FTP 명령
  - FTP 서비스에서는 파일을 송수시하는 get과 put 명령을 주로 사용
  - get 명령은 FTP 서버에서 파일을 가져오고, put 명령은 FTP서버로 파일을 전송
  - cd와 lcd 명령은 FTP 서버와 클라이언트에서 현재 작업 중인 디렉터리를 이동
  - bin Binary 명령은 8비트 데이터를 전송하며, quit 명령은 FTP 연결을 종료

|명령|설명|
|:--|:--|
|get|원격 시스템에서 파일을 수신한다.|
|put|원격 시스템으로 파일을 송신한다.|
|ls|원격 시스템의 현재 디렉터리 아래에 존재하는 파일 목록을 출력한다.|
|cd|원격 시스템의 현재 작업 중인 디렉터리를 이동한다.|
|lcd|로컬 시스템의 현재 작업중인 디렉터리를 이동한다.|
|bin|8비트 송수신 기능을 지정한다.|
|quit|FTP 프로그램을 종료한다.|
### > 명령어 실행 예
- 원격 information.korea.co.kr에 있는 로그인 사용자 hong의 홈 디렉토리 내용을 보는 예
```cmd
ftp> ls
200 PORT command successful.
150 ASCII data connection for /bin/ls (210.99.58.181, 32801) (0 bytes).
README
Book
hong12.Dec00.tar.Z
226 ASCII transfer complete.
34 bytes received in 0.04 seconds (0.83 Kbytes/s)
ftp>
```
### > README라는 파일을 복사하려고 get README 명령을 입력
```cmd
ftp> get README
200 PORT command successful.
150 ASCII data connection for README (210.99.58.181, 32802) (179 bytes).
226 ASCII transfer complete.
local: README remote: README
189 bytes received in 0.021 seconds (8.90 Kbytes/s)
ftp>
```

## FTP 프로토콜
### > 제어 채널과 데이터 채널
- [그림 16-2]라는 FTP 클라이언트와 서버 사이의 연결 설정과정을 설명\
![image](https://user-images.githubusercontent.com/120394200/207102308-35167503-0359-4d43-8324-725c65a2b8f8.png)

### > FTP 명령과 응답
- FTP 클라이언트와 서버는 FTP 명령을 처리하기 위해 제어 채널 사용하며, 클라이언트가 전송한 명령에 대해 서버가 응답하는 방식으로 진행
- [그림 16-4]는 FTP 클라이언트에서 전송되는 FTP 명령과 이에 대한 FTP 서버의 응답 관계를 설명\
![image](https://user-images.githubusercontent.com/120394200/207102572-20fbcf6b-11bf-41fb-9641-543c3b68ffc9.png)

|명령|의미|
|:--|:--|
|USER <로그인 이름>|FTP 서버에 등록된 사용자의 로그인 이름을 전송한다. FTP 클라이언트가 FTP 서버에 가장 먼저 전송하는 명령이다.|
|PASS <암호>|USER 명령이 성공적으로 처리된 직후에 사용되며,로그인 인증을 위한 암호를 전송한다.|
|QUIT|USER와 PASS 명령에 의해 로그인 인증을 성공하면 FTP 클라이언트와 서버 사이에 FTP 세션이 설정되어 파일 송수신 기능을 수행한다. QUIT 명령은 FTP 세션을 끝내고 로그아웃한다.|
|CWD <디렉터리>|FTP 서버에서 현재의 작업 디렉터리를 변경한다. 명령 인수에 이동하고자 하는 디렉터리를 입력한다|
|CDUP|FTP 서버에서 현재의 작업 디렉터리를 상위 디렉터리로 이동한다.|
|PWD|FTP 서버에서 현재의 작업 디렉터리 위치를 회신한다.|
|MKD <디렉터리>|FTP 서버에서 현재 디렉터리 아래에 디렉터리를 새로 생성하며, 인수에 생성할 디렉터리 이름을 표시한다.|
|RMD <디렉터리>|FTP 서버에서 특정 디렉터리를 삭제하며, 삭제할 디렉터리 이름을 인수로 준다.|
|DELE <파일>|FTP 서버에서 디렉터리가 아닌 일반 파일을 삭제한다.|
|LIST <디렉터리>|FTP 서버에서 인수로 지정한 디레겉리의 목록 정보를 요청한다.|
|TYPE <유형>|전송 데이터의 유형을 의미한다. A(ASCII), E(EBCDIC), I(IMAGE) 등의 유형을 지원한다.|
|RNFR <원래 이름>|FTP 서버에서 파일 이름을 변경할 때 RNTO 명령과 함께 사용한다. 파일의 원래 이름은 RNFR 명령으로 지정하므오 RNTO 명령보다 먼저 전송된다.|
|RNTO <새로운 이름>|FTP 서버에서 파일 이름을 변경할 때 RNFR 명령과 함께 사용한다. 파일의 새 이름은 RNTO 명령으로 지정하므로 RNFR 명령보다 나중에 전송된다.|
|RETR <파일>|FTP 서버의 파일을 FTP 클라이언트로 복사할 때 사용하며, 인수로 주어지는 복사 파일은 FTP 서버의 현재 디렉터리에서 찾는다.|
|STOR <파일>|FTP 클라이언트의 파일을 서버로 복사할 때 사용하며,FTP 서버의 현재 디렉터리 아래로 복사한다.|
### > FTP 응답
- FTP 응답 내용은 세 자리의 응답 코드와 설명문으로 구성

|응답 코드|의미 |
|:--|:--|
|125|데이터 채널이 설정되었으며, 이어서 데이터 전송을 시작할 예정이다.|
|200|명령 처리를 완료했다.|
|230|사용자 로그인을 처리했다.|
|250|요청한 파일 동작을 처리했다.|
|331|로그인 이름을 정상적으로 처리했음으로, 암호을 처리해야 한다.|
|425|데이터 채널의 연결이 이루어지지 않았다.|
|426|연결을 취소하였다|
|450|파일 관련 처리를 완료하지 못했다.|
|451|동작 처리를 완료하지 않았다.|
|500|잘못된 명령이다.|
|501| 인수가 잘못되었다.|

### > 로그인 과정
- FTP 로그인은 FTP 클라이언트가 서버와 제어 채널 연결을 설정한 후에 로그인 이름과 암호를 전송하여 FTP 세션 연결을 설정하는 것
- 클라이언트는 FTP 서버의 21번 포트와 TCP 연결 설정을 시도
- TCP 연결이 성공적으로 이루어지면 [그림 16-5]처럼 서버로부터 FTP 서비스를 이용할 수 있음을 의미하는 응답 코드 220을 수신\
![image](https://user-images.githubusercontent.com/120394200/207114694-087b1fa4-b95b-4ea3-9557-c145c49fe26c.png)
### > 파일 송수신 과정
- 파일을 송수신하려면 [그림 16-7]과 같이 데이터 채널이 먼저 설정되어야 함.\
![image](https://user-images.githubusercontent.com/120394200/207115006-4d98fb6d-2a1c-4868-b7d5-ab9133a18b23.png)

## TFTP 프로토콜
### > TFTP 메시지
- TFTP는 파일 복사 작업을 위해 5개의 메시지를 제공

|메시지|의미
|:--|:--|
|RRQ|읽기 요청을 의미하는 RRQ는 TFTP 서버로부터 데이터를 읽기 위한 세션을 설정한다. 파일 이름과 함께 ASCII/이진 파일을 구분 하는 모드가 인수로 주어진다.|
|WRQ|TFTP 서버에 데이터를 쓰기 위한 세션을 설정한다. 파일 이름과 모드가 인수로 주어진다.|
|DATA|클라이언트나 서버가 데이터 블록을 전송할 목적으로 사용한다. TFTP는 클라이언트와 서버 모두 데이터 블록을 전송할 수 있다.|
|ACK|DATA 메시지로 전송된 데이터 블록을 수신하였음을 응답한다. 클라이언트와 서버가 모두 사용한다.|
|ERROR|데이터 전송 과정에서 오류가 발생했을 때 사용한다.|

### > TFTP 세션
- [그림 16-8]은 RRQ 메시지를 이용해 TFTP 서버로부터 파일을 읽어 오는 과정\
![image](https://user-images.githubusercontent.com/120394200/207116637-8905ec4f-b850-4cb3-9603-abe86b8b7da7.png)

- TFTP 클라이언트가 서버에 파일을 전송하기 위해서는 [그림 16-9]처럼 WRQ 메시지를 전송해야 함 TFTP 서버는 오류가 있으면 ERROR 메시지를 회신하고, 오류가 없으면 ACK 메시지를 전송해 데이터 파일을 수신할 수 있음을 나타냄\
![image](https://user-images.githubusercontent.com/120394200/207116956-e834bd3b-3792-4351-a950-e5f02a229301.png)

### > 데이터 전송 오류의 처리
- **TFTP가 사용하는 UDP는 데이터의 신뢰성과 순서 제어 등의 오류와 관련된 기능을 지원하지 않으므로 TFTP 자체에서 이 문제를 해결해야 함**
- TFTP는 연속형 전송 기능을 지원하지 않으므로 하나의 DATA 메시지에 대해 ACK 메시지 처리가 순차적으로 완료되도록 설계
- *데이터 블록 전송을 하나씩 처리하는 단순한 흐름 제어 방식을 사용하므로 UDP의 데이터 도착 순서 문제는 자연스럽게 해결*
- **TFTP는 부정 응답 메시지를 정의하지 않으므로 부정 응답 기능을 지원하지 않음**
- 수신 데이터의 일부가 변형되는 오류가 발생하면 데이터 분실처럼 처리
- 데이터 블록의 중복 문제는 DATA와 ACK 메시지에 정의돈 블록 번호로 처리\
![image](https://user-images.githubusercontent.com/120394200/207120514-8692ef49-143a-430a-859f-68cc3161ed3d.png)
